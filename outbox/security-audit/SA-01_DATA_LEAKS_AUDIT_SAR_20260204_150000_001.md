# SA-01 DATA LEAKS AUDIT REPORT

**Packet:** SAR_20260204_150000_001
**Auditor:** SA-01 Data Leaks
**Target:** Trainer OS (`D:\projects\trainer-os\`)
**Date:** 2026-02-04
**Status:** COMPLETE

---

## EXECUTIVE SUMMARY

| Severity | Count | Status |
|----------|-------|--------|
| CRITICAL | 0 | - |
| HIGH | 6 | FOUND |
| MEDIUM | 1 | FOUND |
| LOW | 0 | - |
| INFO | 3 | NOTED |

**Overall Data Leaks Score:** 72/100 (MODERATE RISK)

---

## HIGH SEVERITY FINDINGS

### DL-001: PII Logged in Cloud Functions - Email Addresses

**Location:** Multiple files in `functions/src/`

| File | Line | PII Type | Risk |
|------|------|----------|------|
| `notificationTriggers.ts` | 209 | Email/Phone | HIGH |
| `workoutNotifications/index.ts` | 133 | Email | HIGH |
| `notifications/index.ts` | 53 | Email | HIGH |
| `led/index.ts` | 199 | Email | HIGH |

**Evidence:**
```typescript
// notificationTriggers.ts:209
console.log(`  To: ${invitation.email || invitation.phone}`);

// workoutNotifications/index.ts:133
console.log(`[EMAIL] Would send to ${email}:`);

// notifications/index.ts:53
console.log(`Would send email to ${payload.to}: ${payload.subject}`);
```

**Impact:** Cloud Functions logs persist and are accessible via GCP Console. PII (email addresses) in logs violates GDPR Article 5 (data minimization) and creates compliance risk.

**Recommendation:**
- Replace direct PII logging with masked/hashed identifiers
- Use structured logging with PII fields redacted
- Example: `console.log(\`[EMAIL] Would send to user:${userId}\`)`

---

### DL-002: PII Logged in Cloud Functions - Phone Numbers

**Location:** Multiple files in `functions/src/`

| File | Line | PII Type | Risk |
|------|------|----------|------|
| `workoutNotifications/index.ts` | 165 | Phone | HIGH |
| `notifications/index.ts` | 90 | Phone (partial) | HIGH |
| `led/index.ts` | 196 | Phone | HIGH |

**Evidence:**
```typescript
// workoutNotifications/index.ts:165
console.log(`[SMS] Would send to ${phone}:`);

// led/index.ts:196
console.log(`Would send SMS to ${clientData.phone}`);
```

**Impact:** Phone numbers logged to Cloud Functions console. Same GDPR/compliance concerns as email logging.

**Recommendation:** Same as DL-001 - use user IDs instead of phone numbers in logs.

---

## MEDIUM SEVERITY FINDINGS

### DL-003: Hardcoded Test Credentials in Source

**Location:** `scripts/seed-data.ts:34, 39`

**Evidence:**
```typescript
const TEST_COACH_PASSWORD = 'test1234';
const TEST_CLIENT_PASSWORD = 'test1234';
```

**Impact:** While these are test credentials in a seed script, they're still visible in source control. If developers reuse these patterns or the script runs in non-dev environments, weak passwords could be created.

**Recommendation:**
- Move test passwords to environment variables
- Use password generation for test data
- Add warning comment that these are dev-only

---

## INFORMATIONAL FINDINGS

### DL-004: LocalStorage Usage (LOW RISK)

**Location:** `frontend/src/context/ThemeContext.tsx`, `frontend/src/components/InstallPrompt.tsx`

**Data Stored:**
- Theme preference (`trainer-os-theme`)
- Brand color (`trainer-os-brand`)
- PWA install dismissed timestamp

**Risk Assessment:** LOW - No sensitive data stored. UI preferences only.

---

### DL-005: .gitignore Properly Configured

**Evidence:**
```
.env
.env.local
.env.*.local
serviceAccountKey.json
```

**Status:** PASS - Sensitive files properly excluded from version control.

---

### DL-006: No .env Files Committed

**Evidence:** `ls D:/projects/trainer-os/*.env*` returned no files.

**Status:** PASS - No environment files in repository.

---

### DL-007: No Debug Flags in Production Code

**Evidence:** Search for `DEBUG = true` only found matches in `node_modules/`.

**Status:** PASS - No debug flags enabled in application code.

---

## FILES SCANNED

| Category | Files Scanned |
|----------|---------------|
| Frontend TypeScript/TSX | ~60 files |
| Cloud Functions | 18 files |
| Configuration | 5 files |
| Total | ~83 files |

---

## RECOMMENDATIONS SUMMARY

| Priority | Action | Files Affected |
|----------|--------|----------------|
| P1 | Remove PII from console.log statements | 5 function files |
| P1 | Implement structured logging | All function files |
| P2 | Move test passwords to env vars | seed-data.ts |
| P3 | Add logging audit to CI pipeline | New |

---

## AUDIT CHAIN STATUS

| Step | Auditor | Status |
|------|---------|--------|
| SA-01 Data Leaks | COMPLETE | 6 HIGH, 1 MEDIUM |
| SA-02 Tenant Isolation | PENDING | Next |
| SA-03 Auth & Secrets | PENDING | - |
| SA-04 OWASP | PENDING | - |
| SA-05 Verdict | PENDING | - |

---

## ROUTING

**Next:** SA-02 Tenant Isolation Auditor
**Command:** `tenant isolation activate`

---

SA-01 Data Leaks Audit Complete
